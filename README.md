# Cyrene

一个使用 Vue + Vite + Tauri 实现，用于批量编辑 markdown frontmatter 的工具

支持功能：

- 以文件树形式查看所有文章的 frontmatter
- 批量增加、删除和归一化 frontmatter
- 将所有文章的 frontmatter 导出为 XLSX 或从 XLSX 导入

## 下载与安装

点击发行版，选择自己对应的架构和系统下载安装：

- Windows 选择后缀名为 exe 和 msi 的，注意绝大多数人都应该下载 x64 架构的，aarch64 是 ARM 架构，目前 windows ARM 非常少见
- MacOS 注意 Intel Mac 选 x64，M1/2/3...系列的选 aarch64
- Linux 只有 x64 的版本，选择自己系统对应的包格式，不确定就用 AppImage

## 使用教程

进入应用后默认位于首页，点击右侧黑色按钮，选择你的博客储存文章的文件夹（如`source/_posts`、`pages`和`source`等），点击确定

等待程序加载文件列表完成后，左侧导航栏按钮会亮起，此时全部按钮可用

### 树形视图查看器

单击左侧导航栏的树状图标（应为第二个图标），进入树形查看器视图

点击中间文件树状视图中的任意文件即可编辑其frontmatter，右侧编辑器会以 JSON 格式显示当前文件的frontmatter内容，按照编辑 JSON 方式编辑即可

当右上角显示绿色的“有效的JSON”时，此JSON可以被正确转换成 frontmatter 并写入，点击下方的“保存当前数据到内存”，修改过后的 JSON 会被保存到当前的内存文件系统中

如需要立刻写入文件系统中，点击导航栏最后一项软盘图标，即可将更改写入文件系统中

### 批量修改工作台

单击左侧导航栏的编辑图标（应为第三个图标），进入批量修改工作台

需要修改的正则表达式即为匹配需修改文件的正则表达式（即白名单），匹配时使用相对于基准路径的路径

当前版本有三个操作可用：

#### 增加字段

第一个输入框为添加字段内容，存在多个可使用半角逗号分割，如`title, author`

第二个输入框为添加内容，**此内容无论值是什么均作为 string 类型处理**

**本操作是非覆盖添加，如果某个 frontmatter 本身就存在该 key 则不会对该 frontmatter 执行添加，会保留原值**

可配合删除字段实现覆盖添加

#### 删除字段

第一个输入框为删除字段内容，存在多个可使用半角逗号分割，如`title, author`

#### 字段归一化

本操作用于将特定的几个字段重定向到一个字段上

第一个输入框为源字段列表，存在多个可使用半角逗号分割，如`title, author`

第二个输入框为目标字段

**当存在多个字段具有值时，目标字段的优先级最高，源字段的优先级按照先后从高到低排序，最终目标字段值为优先级最高的字段的原值。如果所有字段都没有值，则目标值会被设置为一个空的 string**

操作完成后会删除非目标字段的源字段

本操作效果如下：
存在三个文章frontmatter:

```yaml
# 文章A
A:
  cover: aaa
  headimg: bbb
  image: ccc

# 文章B
B:
  headimg: bbb
  image: ccc

# 文章C
# 不存在有关 frontmatter
```

则以 headimg, image为源，cover为目标字段进行字段归一化后得到：

```yaml
# 文章A
A:
  cover: aaa

# 文章B
B:
  cover: bbb

# 文章C
C:
  cover: ''
```

#### 保存和备份

进行修改前会提示用户将当前全部 frontmatter 导出为 XLSX 文件进行备份，建议备份以防止编辑错误

确定无误后点击左侧导航栏最后一个按钮将修改保存到文件系统

### 导出与导入

单击左侧导航栏的盒状图标（应为第四个图标），进入导入与导出

此页面内导出按钮将当前内存中的所有 frontmatter 导出为一个 XLSX 文件以供表格软件编辑

导入按钮将导出的 XLSX 文件导入到当前文章文件夹中，**采用覆盖导入，会删除 XLSX 中不存在的字段**

**导入操作是直接在文件系统中进行操作的，不经过前端的内存文件系统，因此最高效，但也无法撤销**

导入后会自动更新内存中的 frontmatter

### 设置

目前设置还没写好，只能重置基准文件夹

### 注意事项

本应用中所有向文件系统的保存操作均遵循“有效输出只对有效输入负责”原则，如果你的文件夹中本身存在 frontmatter 不完整、不存在 frontmatter 或多 frontmatter 的文件，则保存文件时会发生什么是完全未知的，无法保证源文件的完整

**操作前务必备份好 Markdown 原始文件**

## 其他内容

### 名称来源

项目名称来自于 [星铁的昔涟](https://wiki.biligame.com/sr/%E6%98%94%E6%B6%9F) 的英文名
